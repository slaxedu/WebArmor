import subprocess
import yaml

def launch_scan():
    print("\n[-] Scanning target with nuclei . . .")
    with open('/root/WebArmor/config.yaml', 'r') as config_file:
        config = yaml.safe_load(config_file)

    subdomains_file = config['ASSET_DISCOVERY']['SUBDOMAINS_FILE_PATH']
    output_file = config['VULNERABILITY_SCANNING']['NUCLEI_OUTPUT_FOLDER_PATH']
    templates_path = config['VULNERABILITY_SCANNING']['TEMPLATES_PATH']

    try:
        command = f"nuclei -l {subdomains_file} -t {templates_path} -o {output_file}"
        process = subprocess.Popen(command, shell=True, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
        process.wait()
        print(f"Output saved to : {output_file}")
    except Exception as e:
        print(f"Error executing command '{command}': {e}")
