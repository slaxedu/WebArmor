import subprocess
import yaml
from halo import Halo

def launch_scan():
    with open('/root/WebArmor/config.yaml', 'r') as config_file:
        config = yaml.safe_load(config_file)

    subdomains_file = config['ASSET_DISCOVERY']['SUBDOMAINS_FILE_PATH']
    output_file = config['VULNERABILITY_SCANNING']['NUCLEI_OUTPUT_FOLDER_PATH']
    templates_path = config['VULNERABILITY_SCANNING']['TEMPLATES_PATH']

    try:
        spinner = Halo(text="Scanning target with nuclei . . .", spinner="dots")
        spinner.start()
        command = f"nuclei -l {subdomains_file} -t {templates_path} -o {output_file}"
        process = subprocess.Popen(command, shell=True, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
        process.wait()
        print(f"\nOutput saved to : {output_file}\n")
        spinner.stop()
    except Exception as e:
        print(f"Error executing command '{command}': {e}")

def start_fuzzing():
    with open('/root/WebArmor/config.yaml', 'r') as config_file:
        config = yaml.safe_load(config_file)

    subdomains_file = config['ASSET_DISCOVERY']['SUBDOMAINS_FILE_PATH']
    output_file = config['VULNERABILITY_SCANNING']['NUCLEI_OUTPUT_FOLDER_PATH']
    templates_path = config['VULNERABILITY_SCANNING']['FUZZING_TEMPLATES_PATH']

    try:
        spinner = Halo(text="Fuzzing in Progress . . .", spinner="dots")
        spinner.start()
        command = f"nuclei -l {subdomains_file} -t {templates_path} -nc >> {output_file}"
        process = subprocess.Popen(command, shell=True, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
        process.wait()
        print(f"\nOutput saved to : {output_file}\n")
        spinner.stop()
    except Exception as e:
        print(f"Error executing command '{command}': {e}")
